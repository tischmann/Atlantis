export default class Select{options=new Set;constructor(t,{onchange:e=function(){}}={}){t&&(this.element=t,this.onchange=e,this.uuid=self.crypto.randomUUID(),this.wrapper=document.createElement("div"),this.wrapper.classList.add("relative","grow"),this.label=document.createElement("label"),this.label.classList.add("absolute","select-none","-top-3","left-2","mb-2","text-sm","text-gray-600","bg-white","px-1","text-ellipsis","whitespace-nowrap","overflow-hidden"),this.label.textContent=this.element.getAttribute("title"),this.label.style.maxWidth="-webkit-fill-available",this.input=document.createElement("input"),this.input.setAttribute("value",this.element.value),this.input.setAttribute("type","hidden"),this.input.setAttribute("name",this.element.name),this.input.setAttribute("required",""),this.button=document.createElement("button"),this.button.setAttribute("type","button"),this.button.id="button-"+this.uuid,this.button.classList.add("flex","items-center","justify-start","px-3","py-2","outline-none","border-2","border-gray-200","rounded-lg","w-full","focus:border-sky-600","transition","min-h-11","z-10"),this.button.setAttribute("data-atlantis-select",""),this.ul=document.createElement("ul"),this.ul.id="ul-"+this.uuid,this.ul.classList.add("absolute","select-none","mt-1","hidden","bg-white","rounded-lg","border","border-gray-200","shadow-lg","max-h-[50vh]","overflow-y-auto","z-20"),this.ul.setAttribute("data-atlantis-options",""),this.element.querySelectorAll("option").forEach(t=>{var e=this.createOption({value:t.value,text:t.textContent,level:t.dataset.level,selected:t.selected,disabled:t.disabled});this.ul.append(e),this.options.add(e),t.selected&&(this.button.textContent=t.textContent,this.input.setAttribute("value",t.value))}),this.wrapper.append(this.label,this.input,this.button,this.ul),this.element.parentElement.replaceChild(this.wrapper,this.element),this.wrapper.addEventListener("click",this))}handleEvent(t){var e=t.target;if("click"===t.type)return e.closest("button")===this.button?this.#selectClickHandler(t):this.options.has(e.closest("li"))?this.#optionClickHandler(t):void 0}#selectClickHandler(t){t.stopPropagation();t=t.target;document.querySelectorAll(`[data-atlantis-select]:not(#button-${this.uuid})`).forEach(t=>t.classList.remove("border-sky-600")),document.querySelectorAll(`[data-atlantis-options]:not(#ul-${this.uuid})`).forEach(t=>t.classList.add("hidden")),t.classList.toggle("border-sky-600"),this.ul.classList.toggle("hidden"),document.addEventListener("click",function(){document.querySelectorAll("[data-atlantis-select]").forEach(t=>{t.classList.remove("border-sky-600")}),document.querySelectorAll("[data-atlantis-options]").forEach(t=>{t.classList.add("hidden")})},{once:!0})}#optionClickHandler(t){const e=t.target;t=e.dataset.value;this.setValue(t,e.textContent),this.options.forEach(t=>{t===e?t.classList.add("bg-sky-600","text-white"):t.classList.remove("bg-sky-600","text-white")}),this.onchange(t)}createOption({value:t="",text:e="",level:s=0,selected:a=!1,disabled:i=!1}){var l=document.createElement("li");switch(l.dataset.value=t,l.dataset.level=s,l.innerText=e,l.classList.add("px-4","py-3","cursor-pointer","whitespace-nowrap","min-h-12","hover:bg-sky-600","hover:text-white"),a&&l.classList.add("bg-sky-600","text-white"),i&&l.classList.add("opacity-50","cursor-not-allowed"),""+s){case"1":l.classList.add("pl-8");break;case"2":l.classList.add("pl-12");break;case"3":l.classList.add("pl-16");break;case"4":l.classList.add("pl-20");break;case"5":l.classList.add("pl-24");break;case"6":l.classList.add("pl-28");break;case"7":l.classList.add("pl-32");break;case"8":l.classList.add("pl-36");break;case"9":l.classList.add("pl-40");break;case"10":l.classList.add("pl-44")}return l}getValue(){return this.input.value}setValue(t,e){this.button.textContent=e,this.input.setAttribute("value",t)}update(t){this.options.forEach(t=>t.remove()),this.options.clear(),t.forEach(({value:t="",text:e="",level:s=0,selected:a=!1,disabled:i=!1}={})=>{s=this.createOption({value:t,text:e,level:s,selected:a,disabled:i});this.ul.append(s),this.options.add(s),a&&this.setValue(t,e)})}}
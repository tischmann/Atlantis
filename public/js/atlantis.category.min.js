import Select from"./atlantis.select.min.js";import Dialog from"./atlantis.dialog.min.js";export default class Category{constructor({form:e=null}={}){if(this.form=e,null===this.form&&(this.form=document.querySelector("[data-category]")),!this.form)return console.error("Форма с атрибутом [data-category] не найдена!");this.id=parseInt(this.form.dataset.category),["locale","parent_id"].forEach(e=>{new Select(document.getElementById("select_field_"+e))}),document.getElementById("save-category")?.addEventListener("click",()=>{this.save()}),document.getElementById("add-category")?.addEventListener("click",()=>{this.add()}),document.getElementById("delete-category")?.addEventListener("click",e=>{this.delete({message:e.target.dataset.message})})}save(){this.fetch({url:"/category/"+this.id,method:"PUT",body:JSON.stringify(Object.fromEntries(new FormData(this.form))),onclose:()=>window.location.reload()})}add(){this.fetch({url:"/category",method:"POST",body:JSON.stringify(Object.fromEntries(new FormData(this.form))),onclose:function({id:e}){e?window.location.href="/edit/category/"+e:window.location.reload()}})}delete({message:e="Вы уверены, что хотите удалить категорию?",confirmation:t=!0}={}){t&&!confirm(e)||this.fetch({url:"/category/"+this.id,method:"DELETE",onclose:function(){window.location.href="/edit/categories"}})}fetch({url:e,method:t,body:o=null,onclose:n=null}={}){null===n&&(n=function(){window.location.reload()}),fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:o}).then(e=>{e.json().then(e=>{new Dialog({title:e.title,text:e.message,onclose:()=>{n(e)}})})})}}
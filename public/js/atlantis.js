export default class Atlantis{#handlers=new Map;#lazyimageObserver=this.enter(t=>{var e;1!=t.dataset?.atlantisLazyImage&&((e=new Image).onload=function(){t.dataset.hasOwnProperty("src")?t.src=this.src:t.dataset.hasOwnProperty("bg")&&(t.style.backgroundImage=`url(${this.src})`),t.dataset.atlantisLazyImage=1},t.dataset.hasOwnProperty("src")?e.src=t.dataset.src:t.dataset.hasOwnProperty("bg")&&(e.src=t.dataset.bg))});constructor({log:t=!1}={}){this.log=t,this.uuid=this.getUUID()||this.setUUID(),new MutationObserver(t=>{this.#removeEventListeners(t[0]?.removedNodes)}).observe(document,{childList:!0,subtree:!0})}#removeEventListeners(t){return t instanceof NodeList&&t.forEach(t=>{1==t.nodeType&&(this.off(t),this.#removeEventListeners(t.childNodes))}),this}on(t,e,a,s=!1){var r=this.#handlers.get(e)||new Set;return t.addEventListener(e,a,s),r.add({element:t,handler:a,capture:s}),this.#handlers.set(e,r),this}off(t,e=void 0,a=void 0){for(var[s,r]of this.#handlers)if(s===e||void 0===e){for(const i of r)if((i.handler===a||void 0===a)&&(t.removeEventListener(s,i.handler,i.capture),r.delete(i),void 0!==a))return this;if(void 0!==e)return this}return this}tag(t,{className:e=null,classList:a=[],css:s={},data:r={},attr:i={},text:n=null,html:o=null,append:l=[],on:c={}}={}){const d=document.createElement(t);return e&&(d.className=e),a.length&&d.classList.add(...a),s&&this.css(d,s),r&&this.data(d,r),i&&this.attr(d,i),n?d.textContent=n:o&&(d.innerHTML=o),l?.length&&d.append(...l),Object.entries(c).forEach(([t,e])=>{this.on(d,t,e)}),d}css(a,t={}){return t instanceof Object&&Object.entries(t).forEach(([t,e])=>{a.style[t]=e}),this}data(a,t={}){return Object.entries(t).forEach(([t,e])=>{a.dataset[t]=e}),this}attr(a,t={}){return Object.entries(t).forEach(([t,e])=>{a.setAttribute(t,e)}),this}handleEvent(t){"change"===t.type&&this.setArticleRating(t.target.closest("form[data-id]").dataset.id,t.target.value)}fetch(t,{method:e="POST",headers:a={Accept:"application/json"},body:s=void 0,success:r=function(){},failure:i=function(){}}={}){"string"!=typeof s&&s instanceof FormData==!1&&(s=JSON.stringify(s)),a={Accept:"application/json",...a},"string"==typeof s&&(a={...a,"Content-Length":s.length.toString()}),fetch(t,{method:e,headers:a,body:s}).then(t=>{if(!t.ok)return i(t.statusText),console.error("Atlantis.fetch():",t.status);"application/json"===a.Accept?t.json().then(t=>{this.log&&console.log("Atlantis.fetch():",t),r(t)}).catch(t=>{i(t),console.error("Atlantis.fetch():",t)}):t.text().then(t=>{this.log&&console.log("Atlantis.fetch():",t),r(t)}).catch(t=>{i(t),console.error("Atlantis.fetch():",t)})}).catch(t=>{i(t),console.error("Atlantis.fetch():",t)})}uniqueid(){return self.crypto.randomUUID()}toInt(t){return parseInt(t,10)}getCookie(t){t=document.cookie.match(new RegExp(`(?:^|; )${t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return t?decodeURIComponent(t[1]):void 0}setCookie(t,e,a={}){a={path:"/",secure:!0,domain:window.location.hostname,samesite:"strict",expires:new Date(Date.now()+121e7).toUTCString(),...a};let s=encodeURIComponent(t)+"="+encodeURIComponent(e);Object.entries(a).forEach(([t,e])=>{s+=`; ${t}=`+(e||"")}),document.cookie=s}getUUID(t="atlantis_uuid"){return this.getCookie(t)}setUUID(t="atlantis_uuid"){this.setCookie(t,self.crypto.randomUUID())}dialog({title:t,message:e,buttons:a=[],onclose:s=function(){}}={}){var r="atlantis-dialog-"+this.uniqueid();const i=this.tag("dialog",{classList:["m-0","rounded","shadow-xl","fixed","md:w-96","w-full","top-1/2","left-1/2","transform","-translate-x-1/2","-translate-y-1/2"],attr:{id:r},on:{close:s}}),n=this.tag("div",{classList:["flex","items-center","gap-4"]});return a.forEach(t=>{var e=this.tag("button",{attr:{type:"button"},className:t?.class||"bg-sky-600 text-white hover:bg-sky-500 focus:bg-sky-500 active:bg-sky-500",classList:["inline-block","w-full","px-6","py-2.5","text-white","font-medium","text-xs","leading-tight","uppercase","rounded","shadow-md","hover:shadow-lg","focus:shadow-lg","focus:outline-none","focus:ring-0","active:shadow-lg","transition","duration-150","ease-in-out"],html:t?.text||"Button",on:{click:()=>{"function"==typeof t?.callback&&t?.callback(),i.close()}}});n.append(e)}),i.append(this.tag("form",{attr:{method:"dialog"},append:[this.tag("button",{classList:["absolute","top-4","right-4","ring-0","focus:ring-0","outline-none","text-gray-500"],append:[this.tag("i",{classList:["fas","fa-times","text-xl"],attr:{value:"cancel"}})]}),this.tag("span",{classList:["block","text-xl","font-medium","leading-normal","text-gray-800","pr-12","mb-4","truncate"],text:t}),this.tag("div",{classList:["mb-4"],html:e}),n]})),document.body.append(i),i}enter(a){return new IntersectionObserver((t,e)=>{t.forEach(t=>{t.isIntersecting&&a(t.target)})},{root:null,rootMargin:"0px",threshold:.1})}lazyimage(){var t=["[data-atlantis-lazy-image][data-src]","[data-atlantis-lazy-image][data-bg]"];this.#lazyimageObserver.takeRecords().forEach(t=>{this.#lazyimageObserver.unobserve(t.target)}),t.forEach(t=>{document.querySelectorAll(t).forEach(t=>{1!=t.dataset?.atlantisLazyImage&&this.#lazyimageObserver.observe(t)})})}lazyload(e,{url:a="",token:s="",page:r=1,next:i=1,last:n=1,limit:o=1,sort:l="",order:c="",search:d="",callback:h=function(){}}={}){const g=this.tag("div",{classList:["flex","justify-center","items-center"],attr:{"data-atlantis-lazyload-target":!0},append:[this.tag("div",{classList:["spinner-grow","inline-block","w-8","h-8","bg-sky-500","rounded-full","opacity-0"],attr:{role:"status"}})]}),u=(e.appendChild(g),this.enter(t=>{if(r==n)return this.log&&console.log("Atlantis.lazyload(): No more pages to load"),u.disconnect(),g.remove();this.fetch(a,{headers:{"Content-Type":"application/json","X-Csrf-Token":s},body:{page:r,next:i,last:n,limit:o,sort:l,order:c,search:d},success:t=>{g.insertAdjacentHTML("beforebegin",t.html),r=t.page,i=t.next,n=t.last,s=t.token,e.appendChild(g),h(),this.lazyimage()}})}));u.observe(g)}lightbox(t,e="thumb_"){var a=this.tag("button",{classList:["absolute","top-4","right-4","ring-0","focus:ring-0","outline-none","text-gray-400","hover:text-gray-300","z-[1080]"],attr:{value:"cancel"},append:[this.tag("i",{classList:["fas","fa-times","text-2xl"]})],on:{click:function(t){l.classList.add("hidden"),document.body.classList.remove("overflow-hidden")}}}),s=this.tag("div",{classList:["w-full","h-full","absolute","top-0","left-0","z-[1040]","backdrop-blur-sm"]}),r=this.tag("button",{classList:["absolute","top-[calc(50%-(3.5rem))]","right-0","ring-0","w-14","h-14","m-0","flex","items-center","justify-center","focus:ring-0","outline-none","text-gray-400","hover:text-gray-300","z-[1080]","hover:bg-gray-800"],attr:{value:"next"},append:[this.tag("i",{classList:["fas","fa-chevron-right","text-2xl"]})],on:{click:()=>{var t=o.querySelector("[data-active]")?.nextElementSibling;t&&t.click()}}}),i=this.tag("button",{classList:["absolute","top-[calc(50%-(3.5rem))]","left-0","ring-0","w-14","h-14","m-0","flex","items-center","justify-center","focus:ring-0","outline-none","text-gray-400","hover:text-gray-300","z-[1080]","hover:bg-gray-800"],attr:{value:"prev"},append:[this.tag("i",{classList:["fas","fa-chevron-left","text-2xl"]})],on:{click:()=>{var t=o.querySelector("[data-active]")?.previousElementSibling;t&&t.click()}}});const n=this.tag("div",{classList:["h-[calc(100vh-(100px+3.5rem))]","flex","items-center","justify-center","m-14","mb-0","relative","z-[1080]"]}),o=this.tag("div",{classList:["h-[calc(100px-2rem)]","flex","items-center","gap-4","m-4","relative","z-[1080]"]}),l=this.tag("div",{classList:["hidden","fixed","top-0","left-0","w-screen","h-screen","z-[1040]","bg-black/75","transition-all","ease-in-out"],append:[s,a,r,i,n,o]}),c=(document.body.append(l),t=>{t.dataset.active=!0,t.classList.remove("brightness-50")}),d=t=>{delete t.dataset.active,t.classList.add("brightness-50")},h=()=>{const e=u(n.querySelector("img").src);o.querySelectorAll("img").forEach(t=>{(u(t.src)==e?c:d)(t)})},g=()=>{t.querySelectorAll("img").forEach(t=>{t=this.tag("img",{classList:["object-cover","w-auto","h-full","cursor-pointer"],attr:{width:t.width,height:t.height,src:t.src},on:{click:function(){var t=n.querySelector("img");t.src=u(this.src),t.width=this.width,t.height=this.height,h()}}});o.append(t)})};function u(t){return t.replace(new RegExp(e),"")}const f=t=>{t=t.target,n.innerHTML="",t=this.tag("img",{classList:["object-contain","mx-auto","w-full","h-full"],attr:{width:t.width,height:t.height,src:u(t.src)}});n.appendChild(t),0==o.children.length&&g(),h(),document.body.classList.add("overflow-hidden"),l.classList.remove("hidden"),o.scrollWidth>o.clientWidth?(o.classList.remove("justify-center"),o.classList.add("overflow-x-auto","justify-start")):o.classList.add("justify-center")};t.querySelectorAll("img").forEach(t=>{this.on(t,"click",f)})}}class Sortable{draggingElement=void 0;items=new Set;constructor(t,{ondragstart:e=function(){},ondragover:a=function(){},ondragend:s=function(){}}={}){this.container=t,this.ondragstart=e,this.ondragover=a,this.ondragend=s,this.container.querySelectorAll("li").forEach(t=>{this.items.add(t),t.draggable=!0,t.addEventListener("dragenter",this)}),this.container.addEventListener("dragstart",this)}handleEvent(t){switch(t.type){case"dragstart":return this.#dragStartHandler(t);case"dragenter":return this.#dragEnterHandler(t);case"dragend":return this.#dragEndHandler(t);case"dragover":return this.#dragOverHandler(t)}}#dragOverHandler(t){t.preventDefault()}#dragStartHandler(t){var e=t.target.closest("li");e&&(document.addEventListener("dragover",this),this.draggingElement=e,t.dataTransfer.effectAllowed="move",this.container.addEventListener("dragend",this),this.draggingElement.style.opacity=.7,this.ondragstart(this,t))}#appendPlaceholder(t){var e,a,t=t.target.closest("li");if(t)return e=t.nextSibling,(a=t.previousSibling)?e?a===this.draggingElement?this.container.insertBefore(this.draggingElement,t.nextSibling):this.container.insertBefore(this.draggingElement,t):this.container.insertBefore(t,this.draggingElement):this.container.insertBefore(this.draggingElement,t),this}#dragEnterHandler(t){t.preventDefault();var e=t.target.closest("li");e&&(t.dataTransfer.dropEffect="move",e!==this.draggingElement)&&(this.#appendPlaceholder(t),this.ondragover(this,t))}#dragEndHandler(t){t.preventDefault(),document.removeEventListener("dragover",this),this.draggingElement&&(this.draggingElement.style.opacity=1,this.draggingElement=void 0,this.container.removeEventListener("dragend",this),this.ondragend(this,t))}destroy(){this.container.removeEventListener("dragstart",this),this.items.forEach(t=>t.removeEventListener("dragenter",this)),this.items.clear()}}export{Sortable};
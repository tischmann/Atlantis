export default class Atlantis{#handlers=new Map;#removeListenersObserver=new MutationObserver(e=>{const t=e=>{e instanceof NodeList!=!1&&e.forEach(e=>{1==e.nodeType&&(this.off(e),t(e.childNodes))})};e.forEach(e=>{"childList"===e.type&&t(e.removedNodes)})}).observe(document,{childList:!0,subtree:!0});isEmpty(e){return null==e||(e instanceof Object?0===Object.keys(e).length:e instanceof Array||"string"==typeof e?0===e.length:"number"==typeof e?0===e:"boolean"==typeof e&&!1===e)}uniqueid(){return self.crypto.randomUUID()}dialog({title:e,message:t,buttons:n=[],onclose:r=function(){}}={}){var o="atlantis-dialog-"+this.uniqueid();const s=this.create("dialog",{classList:["m-0","rounded","shadow-xl","fixed","md:w-96","w-full","top-1/2","left-1/2","transform","-translate-x-1/2","-translate-y-1/2"],attr:{id:o},on:{close:r}}),a=this.create("div",{classList:["flex","items-center","gap-4"]});return n.forEach(e=>{var t=this.create("button",{attr:{type:"button"},className:e?.class||"bg-sky-600 text-white hover:bg-sky-500 focus:bg-sky-500 active:bg-sky-500",classList:["inline-block","w-full","px-6","py-2.5","text-white","font-medium","text-xs","leading-tight","uppercase","rounded","shadow-md","hover:shadow-lg","focus:shadow-lg","focus:outline-none","focus:ring-0","active:shadow-lg","transition","duration-150","ease-in-out"],html:e?.text||"Button",on:{click:()=>{"function"==typeof e?.callback&&e?.callback(),s.close()}}});a.append(t)}),s.append(this.create("form",{attr:{method:"dialog"},append:[this.create("button",{classList:["absolute","top-4","right-4","ring-0","focus:ring-0","outline-none","text-gray-500"],append:[this.create("i",{classList:["fas","fa-times","text-xl"],attr:{value:"cancel"}})]}),this.create("span",{classList:["block","text-xl","font-medium","leading-normal","text-gray-800","pr-12","mb-4","truncate"],text:e}),this.create("div",{classList:["mb-4"],html:t}),a]})),document.body.append(s),s}shown(e){return!!e&&0<(e?.offsetWidth??0)+(e?.offsetHeight??0)}on(e,t,n,r=!1){var o;return e&&(o=this.#handlers.get(t)||new Set,e.addEventListener(t,n,r),o.add({element:e,handler:n,capture:r}),this.#handlers.set(t,o)),this}off(e,t=void 0,n=void 0){if(e)for(var[r,o]of this.#handlers)if(r===t){for(const s of o)if(s.handler===n&&(e&&e.removeEventListener(r,s.handler,s.capture),o.delete(s),n))return this;if(t)return this}return this}submit({action:e="",target:t="_blank",method:n="post",data:r={}}){let o=this.create("form",{attr:{action:e,target:t,method:n},css:{display:"none"}});const s=(n,e)=>{e instanceof Object?Object.entries(e).forEach(([e,t])=>{s(n+`[${e}]`,t)}):o.append(this.create("input",{attr:{type:"hidden",name:n,value:e}}))};Object.entries(r).forEach(([e,t])=>{s(e,t)}),document.body.append(o),o.submit(),o.remove(),o=void 0}trigger(e,t,n){return e&&e.dispatchEvent(new CustomEvent(t,n)),this}fetch({url:e="",method:t="GET",headers:n={"Content-Type":"application/json;charset=utf8",Accept:"application/json"},body:r={},mode:o="cors",cache:s="no-cache",credentials:a="same-origin",redirect:i="follow",referrerPolicy:c="no-referrer"}={}){return t=t.toUpperCase(),r=["POST","PUT"].includes(t)?JSON.stringify(r):void 0,fetch(e,{method:t,headers:{"Content-Type":"application/json;charset=utf8",Accept:"application/json",...n,"Content-Length":r?.length||0},body:r,mode:o,cache:s,credentials:a,redirect:i,referrerPolicy:c})}async(t=function(){}){return new Promise(e=>{t(),e()})}onresize({element:e,callback:t=function(){}}){t=new ResizeObserver(t);return t.observe(e),t}onadd({elements:n=[],callback:r=function(){},options:e={childList:!0,subtree:!0}}){var t=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(t=>{n.forEach(e=>e&&e.contains(t)?r():void 0)})})});return t.observe(document,e),t}onremove({elements:e=[],callback:n=function(){},options:t={childList:!0,subtree:!0}}){const r=new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.removedNodes.length&&!t&&(n(),t=!0)})});return e.forEach(e=>{e&&(e.parentElement?r.observe(e.parentElement,t):e&&r.observe(e,t))}),r}onchange({elements:e=[],callback:t=function(){},options:n={childList:!0,attributes:!0,characterData:!0}}){const r=new MutationObserver(e=>{t()});return e.forEach(e=>{e&&r.observe(e,n)}),r}jfetch({url:e="",method:t="GET",body:n={},success:r=function(){},failure:o=function(){}}={}){this.fetch({url:e,method:t,body:n,headers:{"Content-Type":"application/json;charset=utf8",Accept:"application/json"}}).then(e=>{e.json().then(e=>{r(e)}).catch(e=>{console.error(e),o(e)})}).catch(e=>{console.error(e),o(e)})}pad(e,t=2){return(""+e).padStart(t,"0")}center(e){return e?this.css(e,{position:"absolute",top:(window.innerHeight-e.offsetHeight)/2+"px",left:(window.innerWidth-e.offsetWidth)/2+"px",bottom:"unset",right:"unset",margin:0}):this}eval(r){return r&&r.querySelectorAll("script").forEach(e=>{var t=document.createRange(),n=e.outerHTML;e.remove(),t.selectNode(r),r.append(t.createContextualFragment(n))}),this}create(e,{className:t=null,classList:n=[],css:r={},data:o={},attr:s={},text:a=null,html:i=null,append:c=[],on:l={}}={}){const d=document.createElement(e);return t&&(d.className=t),n.length&&d.classList.add(...n),r&&this.css(d,r),o&&this.data(d,o),s&&this.attr(d,s),a?d.textContent=a:i&&(d.innerHTML=i),c?.length&&d.append(...c),Object.entries(l).forEach(([e,t])=>{this.on(d,e,t)}),d}createNS(e,t={}){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.entries(t).forEach(([e,t])=>{n.setAttributeNS(null,e,t.toString())}),n}parseRegExp(e){var t=e.match(/^\/(.*)\/([giumx]*)$/);return t?2<t.length?new RegExp(t[1],t[2]):new RegExp(t[1]):new RegExp(e)}getCookie(e){e=document.cookie.match(new RegExp(`(?:^|; )${e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return e?decodeURIComponent(e[1]):void 0}setCookie(e,t,n={}){n={path:"/",secure:!0,domain:window.location.hostname,samesite:"strict",expires:new Date(Date.now()+121e7),...n};let r=encodeURIComponent(e)+"="+encodeURIComponent(t);return n.expires instanceof Date&&(n.expires=n.expires.toUTCString()),Object.entries(n).forEach(([e,t])=>{r+=`; ${e}=`+(t||"")}),document.cookie=r,this}deleteCookie(e){return this.setCookie(e,"",{expires:new Date(Date.now()-1)}),this}log(e,t){console.log(e.constructor.name+"():",t)}warn(e,t){console.warn(e.constructor.name+"():",t)}error(e,t){console.error(e.constructor.name+"():",t)}css(n,e={}){return e instanceof Object&&Object.entries(e).forEach(([e,t])=>{n.style[e]=t}),this}data(n,e={}){return Object.entries(e).forEach(([e,t])=>{n.dataset[e]=t}),this}attr(n,e={}){return Object.entries(e).forEach(([e,t])=>{n.setAttribute(e,t)}),this}highlight(e,r="",{tag:o="span",className:s="highlight"}={}){let a=0;var t;return e&&(t=r?new RegExp(`(${r})`,"gim"):new RegExp(`/(<${o} class="${s}">|</${o}>)/`,"gim"),r=r.replace(/\\/,""),e.innerHTML=e.textContent.replace(t,function(e,...t){var n;return r?((n=document.createElement(o)).className=s,n.textContent=t[0],a++,n.outerHTML):(a++,"")})),a}uniqid(){return Math.random().toString(36).slice(2,11)}animate({timing:r=function(e){return e},draw:o=function(e){},duration:s=200,after:a=function(){}}={}){const i=performance.now();return requestAnimationFrame(function e(t){let n=(t-i)/s;1<n&&(n=1),o(r(n)),n<1?requestAnimationFrame(e):a()}),this}}
export default class Select{options=new Set;uuid=self.crypto.randomUUID();constructor(t,{onchange:e=function(){},token:s=""}={}){t&&(this.element=t,this.onchange=e,this.token=s,this.wrapper=document.createElement("div"),this.wrapper.classList.add("relative","w-full","grow"),this.label=document.createElement("div"),this.label.classList.add("absolute","select-none","-top-3","left-2","mb-2","text-sm","text-gray-600","bg-white","dark:bg-gray-800","dark:text-gray-400","px-1","text-ellipsis","whitespace-nowrap","overflow-hidden"),this.label.textContent=this.element.title,this.label.style.maxWidth="-webkit-fill-available",this.input=document.createElement("input"),this.input.setAttribute("value",this.element.value),this.input.setAttribute("type","hidden"),this.input.setAttribute("name",this.element.name),this.input.setAttribute("required",""),this.button=document.createElement("div"),this.button.id="button-"+this.uuid,this.button.classList.add("flex","items-center","justify-start","px-3","py-2","outline-none","border-2","border-gray-200","dark:border-gray-600","rounded-lg","w-full","focus:border-sky-600","transition","min-h-11","z-10"),this.button.setAttribute("data-atlantis-select",""),this.ul=document.createElement("ul"),this.ul.id="ul-"+this.uuid,this.ul.classList.add("absolute","select-none","mt-1","hidden","bg-white","dark:bg-gray-800","rounded-lg","border-2","border-sky-600","shadow-xl","max-h-[50vh]","overflow-y-auto","z-20"),this.ul.setAttribute("data-atlantis-options",""),this.element.querySelectorAll("option").forEach(t=>{this.#appendOption({value:t.value,text:t.textContent,level:t.dataset.level,selected:t.selected,disabled:t.disabled})}),this.wrapper.append(this.label,this.input,this.button,this.ul),this.element.parentElement.replaceChild(this.wrapper,this.element),this.wrapper.addEventListener("click",this))}handleEvent(t){var e=t.target;if("click"===t.type){if(e.closest("[data-atlantis-select]")===this.button)return this.#selectClickHandler(t);if(this.options.has(e.closest("[data-atlantis-option]")))return this.#optionClickHandler(t)}return this}#appendOption({value:t="",text:e="",level:s=0,selected:a=!1,disabled:i=!1}){s=this.#createOption({value:t,text:e,level:s,selected:a,disabled:i});this.ul.append(s),this.options.add(s),a&&this.setValue(t,e)}#createOption({value:t="",text:e="",level:s=0,selected:a=!1,disabled:i=!1}){var l=document.createElement("li");switch(l.dataset.value=t,l.dataset.level=s,l.innerText=e,l.setAttribute("data-atlantis-option",""),l.classList.add("px-4","py-3","cursor-pointer","whitespace-nowrap","min-h-12","hover:bg-sky-600","hover:text-white"),a&&l.classList.add("bg-sky-600","text-white"),i&&l.classList.add("opacity-50","cursor-not-allowed"),""+s){case"1":l.classList.add("pl-8");break;case"2":l.classList.add("pl-12");break;case"3":l.classList.add("pl-16");break;case"4":l.classList.add("pl-20");break;case"5":l.classList.add("pl-24");break;case"6":l.classList.add("pl-28");break;case"7":l.classList.add("pl-32");break;case"8":l.classList.add("pl-36");break;case"9":l.classList.add("pl-40");break;case"10":l.classList.add("pl-44")}return l}getValue(){return this.input.value}setValue(t,e){this.button.textContent=e,this.input.setAttribute("value",t)}#selectClickHandler(t){t.stopPropagation();t=t.target;document.querySelectorAll(`[data-atlantis-select]:not(#button-${this.uuid})`).forEach(t=>t.classList.remove("border-sky-600")),document.querySelectorAll(`[data-atlantis-options]:not(#ul-${this.uuid})`).forEach(t=>t.classList.add("hidden")),t.classList.toggle("border-sky-600"),this.ul.classList.toggle("hidden"),document.addEventListener("click",function(){document.querySelectorAll("[data-atlantis-select]").forEach(t=>{t.classList.remove("border-sky-600")}),document.querySelectorAll("[data-atlantis-options]").forEach(t=>{t.classList.add("hidden")})},{once:!0})}#optionClickHandler(t){const e=t.target.closest("[data-atlantis-option]");var t=e.dataset.value,s=t!==this.getValue();this.setValue(t,e.textContent),this.options.forEach(t=>{t===e?t.classList.add("bg-sky-600","text-white"):t.classList.remove("bg-sky-600","text-white")}),this.onchange(t,s)}update(t={}){this.options.forEach(t=>t.remove()),this.options.clear(),t.forEach(({value:t="",text:e="",level:s=0,selected:a=!1,disabled:i=!1}={})=>{this.#appendOption({value:t,text:e,level:s,selected:a,disabled:i})})}destroy(){this.wrapper.removeEventListener("click",this),this.wrapper.parentElement.replaceWith(this.element,this.wrapper)}}